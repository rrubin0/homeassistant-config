#####################################################################
#    @package          :     watchdog
#    @description      :     notify on events while we are away
#####################################################################
homeassistant:
  customize:
    ################################################
    ## Node Anchors
    ################################################
    package.node_anchors:
      customize: &customize
        package: 'watchdog'


####################################################################
## Automation
####################################################################
automation:
#### While we are away ...
  ## Notify if master bedroom lights turned on
  - alias: Notify if away and bedroom lights turn on
    initial_state: 'on'
    hide_entity: true
    trigger:
      - platform: state
        entity_id: group.mbr_lights
        to: 'on'

    condition:
      - condition: state
        entity_id: group.all_devices
        state: 'not_home'

    action:
      - service: notify.ios_i8plus
        data:
          title: "Home Assistant Alert"
          message: "Master Bedroom Lights On"


  ## Notify if an exterior door is opened
  - alias: Notify if away and door is opened
    initial_state: 'on'
    hide_entity: true
    trigger:
      - platform: state
        entity_id:
          - sensor.front_door_state
          - sensor.south_door_state
          - sensor.kitchen_door_state
          - sensor.beach_door_state
        to: 'Open'

    condition:
      - condition: state
        entity_id: group.all_devices
        state: 'not_home'

    action:
      - service: notify.ios_i8plus
        data:
          title: "Exterior Door Opened"
          message: "Someone opened the {{ trigger.to_state.attributes.friendly_name }}."

